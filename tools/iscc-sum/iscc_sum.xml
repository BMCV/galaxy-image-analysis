<tool id="iscc_sum" name="Generate ISCC hash" version="@TOOL_VERSION@+galaxy@VERSION_SUFFIX@" profile="24.1">
    <description>with ISCC-SUM</description>

    <macros>
        <import>macros.xml</import>
        <import>creators.xml</import>
    </macros>
    <expand macro="requirements" />
    <expand macro="version_command" />
    <creator>
        <expand macro="creators/iscc" />
        <expand macro="creators/lco" />
        <expand macro="creators/maartenpaul" />
        <expand macro="creators/etzm" />
    </creator>
        
    <command detect_errors="exit_code"><![CDATA[
        ## Generate ISCC hash for input dataset
        iscc-sum '${input_file}' | cut -d':' -f2 | cut -d' ' -f1 >> '${output_file}'
    ]]></command>

    <inputs>
        <param name="input_file" type="data" format="data" label="Input file"
               help="Any file type - ISCC-SUM will generate a checksum and similarity hash. When a collection is provided, generates one hash per dataset."/>
    </inputs>
    
    <outputs>
        <data name="output_file" format="txt" label="${tool.name} on ${on_string}"/>
    </outputs>
    
    <tests>
        <!-- Test 1: Single dataset PNG -->
        <test expect_num_outputs="1">
            <param name="input_file" value="test1.png"/>
            <output name="output_file">
                <assert_contents>
                    <has_line line="K4AOMGOGQJA4Y46PAC4YPPA63GKD5RVFPR7FU3I4OOEW44TYXNYOTMY" />
                    <has_n_lines n="1" />
                </assert_contents>
            </output>
        </test>
        
        <!-- Test 2: Single dataset FASTA -->
        <test expect_num_outputs="1">
            <param name="input_file" value="test3.fasta"/>
            <output name="output_file">
                <assert_contents>
                    <has_line line="K4AKF7PTZ7JTAAYZ7YZHZPR5RETKYXXE7RTBTJA4JX5GQQMSLZRC6QQ" />
                    <has_n_lines n="1" />
                </assert_contents>
            </output>
        </test>
        
        <!-- Test 3: Single dataset TIFF -->
        <test expect_num_outputs="1">
            <param name="input_file" value="test2.tiff"/>
            <output name="output_file">
                <assert_contents>
                    <has_line line="K4AGSPOSB5SS2X427WZ27QASTSBVTS55DXLMFDF7WOJKEOSTDEI3OXQ" />
                    <has_n_lines n="1" />
                </assert_contents>
            </output>
        </test>
    </tests>
    
    <help><![CDATA[
What it does
============

Generates an International Standard Content Code (ISCC) based checksum and similarity hash for datasets.

The ISCC-SUM creates a content-derived identifier that:

- Creates a unique 55-character checksum based on dataset content
- Generates a similarity hash for content comparison
- Works with any file format

Dataset Mapping
===============

When you provide a collection, Galaxy automatically runs this tool once per dataset, generating individual ISCC hashes for each dataset in the collection.

Output
======

A text file contains the ISCC-SUM code (55 characters)

Example output::

    K4AOMGOGQJA4Y46PAC4YPPA63GKD5RVFPR7FU3I4OOEW44TYXNYOTMY

Use Cases
=========

- Generate checksums for file integrity verification
- Create similarity hashes for duplicate detection
- Track file provenance and changes over time

ISCC Structure
==============

The 55-character ISCC code contains multiple components:

- **Data-Code**: Content similarity hash (used for similarity detection)
- **Instance-Code**: Exact file checksum

Workflow Examples
=================

Generate hashes for a collection
---------------------------------

::

    Input: Collection of 100 dataset
    ↓
    [Generate ISCC hash] ← runs 100 times
    ↓
    Output: Collection of 100 hash files
    ↓
    [Collapse Collection] ← Galaxy tool
    ↓
    Result: Single file with all hashes

Create reference checksums
---------------------------

::

    Input: Original dataset
    ↓
    [Generate ISCC hash]
    ↓
    Store hashes for future verification

More Information
================

For details about ISCC: https://sum.iscc.codes/
    ]]></help>

    <expand macro="citations" />
    
</tool>